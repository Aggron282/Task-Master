<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>

    <meta charset="utf-8">

    <title> Task Master </title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link href="https://fonts.cdnfonts.com/css/amazon-ember" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link href ='/css/login.css' rel="stylesheet"/>
    <link href ='/css/animations.css' rel="stylesheet"/>

    <link rel = "stylesheet" href = "/css/list_modal.css"/>

    <link rel = "stylesheet" href = "/css/navbar_dashboard.css"/>
    <link rel = "stylesheet" href = "/css/header.css"/>
    <link rel = "stylesheet" href = "/css/boards.css"/>
    <link rel = "stylesheet" href = "/css/my_board.css"/>
    <link rel = "stylesheet" href = "/css/label_modal.css"/>
    <link rel = "stylesheet" href = "/css/board_modal.css"/>
    <link rel = "stylesheet" href = "/css/detail.css"/>
    <link rel = "stylesheet" href = "/css/profile_modal.css"/>
    <link rel = "stylesheet" href = "/css/board_settings.css"/>
    <link rel = "stylesheet" href = "/css/file_attacher.css"/>
    <link rel = "stylesheet" href = "/css/move_modal.css"/>

    <link href="https://fonts.googleapis.com/css2?family=Allerta+Stencil&family=Archivo+Black&family=Dancing+Script:wght@400..700&family=Exo+2:wght@600&family=Exo:wght@800;900&family=Heebo:wght@800&family=Montserrat:ital,wght@0,400;0,500;0,600;0,700;0,900;1,600&family=Noto+Sans:wght@300&family=Poppins:wght@600&family=Protest+Revolution&family=Roboto+Condensed:wght@300;400&family=Roboto:ital,wght@0,300;1,100&family=Rubik+Distressed&family=Rubik+Moonrocks&family=Special+Elite&family=Teko:wght@300;500&family=Vast+Shadow&family=Work+Sans:wght@200;300;400&display=swap" rel="stylesheet">

  </head>

  <body>

    <div class="detail-wrapper"></div>
    <div class = "container-fluid db">

      <nav class="navbar-wrapper">

      </nav>

      <div class="board-grid">
      <div class="sidebar-container">
          <div class="sidebar-bg"></div>
          <div class="sidebar">
              <div class="menu-item">‚ûï Add List</div>
              <div class="menu-item">üìÇ Boards</div>
              <div class="menu-item menu-item--archive" >üóÉ Show Archived Tasks</div>
              <div class="menu-item menu-item--all">üìÅ Show All Tasks</div>
              <div class="menu-item menu-item--watch">üëÅÔ∏è Show Watched Tasks</div>
              <div class="menu-item menu-item--settings">‚öôÔ∏è Board Setting</div>
              <h6 class="subtitle"> Your Boards </h6>
              <div class="board-holder">

              </div>
          </div>
      </div>


        <div class="my_taskboard_container">

          <div class="task_parent">
            <div class="archive_board">
                <div class="archive-container archive--container--archive">
                    <img class = "t-img" src = "/imgs/options/6.png"/>


                </div>
                <div ></div>
                <div class="archive-container archive--container--delete">
                    <img class = "t-img" src = "/imgs/options/7.png"/>

                </div>
            </div>
            <div></div>

            <div class="inner_container_task-">
              <div class="task_heading_container"></div>
                <div class="inner_container_task"></div>
            </div>
          </div>

        </div>
      </div>

      <!-- Include this inside your HTML body -->
      <div class="board-settings-modal hidden">
        <div class="board-settings-content">
          <span class="board-settings-close">&times;</span>

          <div class="board-settings-name">
            <input type="text" value="Board Name" readonly>
            <span class="board-settings-edit-icon">‚úé</span>
          </div>

          <div class="board-settings-grid">
            <button>Change background</button>
            <button>Archive board</button>
            <button>Copy board</button>
            <button>Watch board</button>
            <button class="board-settings-close-board">Close board</button>
          </div>
        </div>
      </div>


    </div>

    <div class="profile-holder">

    </div>
    <div class="move-canopy">

    </div>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src = "/js/util.js"></script>
  <script src = "/js/file_attacher.js"></script>

  <script src = "/js/renderer.js"></script>
  <script src = "/js/drag_drop_tasks.js"></script>
  <script src = "/js/my_board.js"></script>
  <script src = "/js/side_bar.js"></script>
  <script src = "/js/profile.js"></script>
  <script src = "/js/board_settings.js"></script>
  <script>
  axios.get("/api/user").then(async ({data})=>{

    var {profilePicture} = data.profile;
    var navbar_wrapper = document.querySelector(".navbar-wrapper");

    navbar_wrapper.innerHTML = ReturnNavbarBoard(data.profile.username);

    var container = document.querySelector(".profile-holder");
    var wrapper = document.querySelector(".db");

    InitProfile(container,wrapper);

    var profile_holder = document.querySelectorAll(".profile-img-wrapper");
    var move_holder = document.querySelector(".move-canopy");

    let id = url.split("id=:")[1];

    id = id.split("/")[0]

    var {data} = await axios.get(`/api/board/current/${id}`);
    var response = await axios.get(`/api/board/all/`);

    var board = data.board;
    var all_boards = response.data.boards;

    move_holder.innerHTML += ReturnMoveToBoardModal(all_boards);
    // move_holder.innerHTML += ReturnMoveToListModal(board);


    var exit_move_modal = document.querySelector(".exit--board--modal");
    var action_list_move_board = document.querySelectorAll(".list-action--move");
    var action_list_copy_board = document.querySelectorAll(".list-action--copy");

    for(var i =0; i <action_list_move_board.length;i++){

      action_list_move_board[i].addEventListener("click",(e)=>{
        var parent = e.target.parentElement;

        const moveWrapper = document.querySelector(".move-board-wrapper");

        moveWrapper.setAttribute("data-type","0");
        moveWrapper.setAttribute("list_id",parent.getAttribute("list_id"));

        if (moveWrapper) moveWrapper.classList.toggle("hidden");

      });

    }

    for(var i =0; i <action_list_copy_board.length;i++){

      action_list_copy_board[i].addEventListener("click",(e)=>{

        var parent = e.target.parentElement;
        const moveWrapper = document.querySelector(".move-board-wrapper");

        moveWrapper.setAttribute("data-type","1");
        moveWrapper.setAttribute("list_id",parent.getAttribute("list_id"));

        if (moveWrapper) moveWrapper.classList.toggle("hidden");

      });

  }

    exit_move_modal.addEventListener("click", function(e) {
        const moveWrapper = document.querySelector(".move-board-wrapper");
        if (moveWrapper) moveWrapper.classList.toggle("hidden");
    });

    var board_items_in_move_modal = document.querySelectorAll(".board-move-item");

    for(var i =0; i < board_items_in_move_modal.length; i++){

      var board_item = board_items_in_move_modal[i];

      board_item.addEventListener("click",async (e)=>{
          var board_id = e.target.getAttribute("board_id");
          var current_board_id = id;
          const moveWrapper = document.querySelector(".move-board-wrapper");
          var list_id = moveWrapper.getAttribute("list_id");
          console.log(current_board_id,board_id,list_id);
          var data;
          var isMove = moveWrapper.getAttribute("data-type") == 0 ? true : false;
          if(isMove){
            data = await  axios.post("/api/move/list",{list_id:list_id,current_board_id:current_board_id,board_id:board_id});
          }else{
            data = await  axios.post("/api/copy/list",{list_id:list_id,current_board_id:current_board_id,board_id:board_id});
          }
          console.log(data);

        });

    }
      // for(var i =0; i <profile_holder.length;i++){
      //   PopulateProfileImg(profile_holder[i],profilePicture,data.profile.username);
      // }


  // document.addEventListener("click", function(e) {
  //
  //   if (e.target.classList.contains("exit--list--modal")) {
  //
  //     const moveWrapper = document.querySelector(".list-wrapper");
  //
  //     if (moveWrapper) moveWrapper.classList.toggle("hidden");
  //
  //   }
  //
  // });


  });
  </script>


 </body>

</html>
